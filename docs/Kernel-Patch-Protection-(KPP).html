<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#151515">
<meta name="msapplication-navbutton-color" content="#151515">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->


<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Hack Different - Apple Knowledge | Hack Different is a community of research around the Apple platform.</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Hack Different - Apple Knowledge" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hack Different is a community of research around the Apple platform." />
<meta property="og:description" content="Hack Different is a community of research around the Apple platform." />
<link rel="canonical" href="https://docs.hackdiffe.rent/docs/Kernel-Patch-Protection-(KPP).html" />
<meta property="og:url" content="https://docs.hackdiffe.rent/docs/Kernel-Patch-Protection-(KPP).html" />
<meta property="og:site_name" content="Hack Different - Apple Knowledge" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hack Different - Apple Knowledge" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Hack Different is a community of research around the Apple platform.","headline":"Hack Different - Apple Knowledge","url":"https://docs.hackdiffe.rent/docs/Kernel-Patch-Protection-(KPP).html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>Hack Different - Apple Knowledge</h1>
        </a>
        <h2>Hack Different is a community of research around the Apple platform.</h2>

        <section id="downloads">
          
          <a href="https://github.com/hack-different/apple-knowledge" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p>As of iOS9, all arm64 devices have kernel patch protection implemented wherein something likely other than the kernel checks every so often for kernel integrity, otherwise panics.</p>

<p>Checked ranges are __TEXT and __DATA.__const.
It is speculated that checks are enforced by either the SEP or the Secure Monitor.</p>

<p>Current attempts to bypass KPP actually avoid it entirely and were demonstrated in Pangu9. 
The general idea is not to patch __TEXT, but rather data structures.</p>

<p>In particular, Pangu9 replaced hooks in AMFIâ€™s MAC policy to either disable or alter the checks.</p>

<p>This technique has been mitigated in iOS 9.2 by moving MAC policies in __const.</p>

<p>LwVM::_mapForIO patches on the other hand are applied by actually unprotecting the root partition in the partition structure rather than by patching the protection check out. This can be done by finding the LwVM manager, which contains an array of pointers to partition structures. To find the LwVM manager, take a look at a LightweightVolumeManagerUserClient object.</p>

<hr>
<p>Found this by <a href="https://github.com/xerub" class="user-mention">@xerub</a> <a href="https://xerub.github.io/ios/kpp/2017/04/13/tick-tock.html">Tick (FPU) Tock (IRQ)</a></p>

      </section>
    </div>
  </body>
</html>

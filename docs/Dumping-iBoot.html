<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#151515">
<meta name="msapplication-navbutton-color" content="#151515">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->


<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Hack Different - Apple Knowledge | Hack Different is a community of research around the Apple platform.</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Hack Different - Apple Knowledge" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hack Different is a community of research around the Apple platform." />
<meta property="og:description" content="Hack Different is a community of research around the Apple platform." />
<link rel="canonical" href="https://docs.hackdiffe.rent/docs/Dumping-iBoot.html" />
<meta property="og:url" content="https://docs.hackdiffe.rent/docs/Dumping-iBoot.html" />
<meta property="og:site_name" content="Hack Different - Apple Knowledge" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hack Different - Apple Knowledge" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Hack Different is a community of research around the Apple platform.","headline":"Hack Different - Apple Knowledge","url":"https://docs.hackdiffe.rent/docs/Dumping-iBoot.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>Hack Different - Apple Knowledge</h1>
        </a>
        <h2>Hack Different is a community of research around the Apple platform.</h2>

        <section id="downloads">
          
          <a href="https://github.com/hack-different/apple-knowledge" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p>This information only applies to iBoot64 on iOS 8 or lower.</p>

<p>In order to dump iBoot, you need:</p>

<ol>
  <li>Kernel read/write (eg task_for_pid 0)</li>
  <li>gPhysBase and gVirtBase</li>
  <li>A pointer to the kernel pmap’s level1 translation table entries.</li>
</ol>

<p>Once those are obtained, just add a mapping for gPhysBase to the level1 table (code for this is available upon request; drop me a pm on freenode), mapping 1GB of physical memory at a given virtual address.
Additionally, make sure to clear the read only bit and set the EL0-accessible bit.</p>

<p>At this point, it’s simple matter of memmem to figure out where iBoot is hiding in phys. Given a gPhysBase map  at 0xffffffc3c0000000, this code should do the trick.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int main(int argc, char **argv, char **envp) {
	char* base = (char*) 0xffffffc3c0000000;
	char* sig = (char*) "FFiBoot for ";
	char* iboot = (char*) memmem(base, (1&lt;&lt;30), sig+2, strlen(sig)-2);
	while (*(iboot-1) == 'F' &amp;&amp; *(iboot-2) == 'F') {
		iboot ++;
		/* should fix size up here but too lazy lol */
		iboot = (char*) memmem(iboot, (1&lt;&lt;30), sig+2, strlen(sig)-2);
		assert(iboot);
	}
	iboot = (char*) (((uintptr_t)iboot) &amp; (~0xFFF));
	printf("found iboot at %p\n", iboot);
	return 0;
}
</code></pre></div></div>

      </section>
    </div>
  </body>
</html>
